


<!doctype html>
<html class="no-js" lang="en">
  
<head><!-- begin head.html -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
    Paging | Scylla Docs
    </title>
    <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />

    <link rel="icon" href="../../_static/img/favicon.ico" type="image/x-icon"/>
    <link rel="canonical" href="https://docs.scylladb.com/">

    <link rel="author" href="mailto:info@scylladb.com">
    <link rel="stylesheet" href="../../_static/" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_tabs/tabs.css" />
    
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/foundation.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/doc/main.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>

    <script src="../../_static/js/vendor/modernizr.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T8P2JP');</script>
    <!-- End Google Tag Manager -->

    <!-- Marketo -->
    <script type="text/javascript"> (function() { var didInit = false; function initMunchkin() { if(didInit === false) { didInit = true; Munchkin.init('791-QBF-350'); } } var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//munchkin.marketo.net/munchkin.js'; s.onreadystatechange = function() { if (this.readyState == 'complete' || this.readyState == 'loaded') { initMunchkin(); } }; s.onload = initMunchkin; document.getElementsByTagName('head')[0].appendChild(s); })(); </script>
    <!-- End Marketo -->

<!-- end head.html -->
</head>

<body>
<header id="header" class="animated">
    <div class="topbar_continer contain-to-grid clearfix">
        <nav class="top-bar" id="top-bar" data-topbar role="navigation">
            <ul class="title-area">
                <li class="name">
                    <div class="logo">
                        <a href="https://docs.scylladb.com/"><img src="../../_static/img/logo-scylla-docs.svg" alt="" width="151"></a>
                    </div>
                </li>
                <li class="toggle-topbar"><a href="#"><span class="icon-manu"></span></a></li>
            </ul>
            <section class="top-bar-section clearfix">
                <ul class="right">
                    
                    <li>
                        <a href="https://scylladb.github.io/java-driver/">Scylla Java Driver</a>
                    </li>
                    
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">Scylla Cloud</a>
                    </li>
                    
                    <li>
                        <a href="https://university.scylladb.com/">Scylla University</a>
                    </li>
                    
                    <li>
                        <a href="https://www.scylladb.com/">ScyllaDB Home</a>
                    </li>
                    
                    <li class="search_continer show-for-medium-up">	
                        <ci-search></ci-search>	
                    </li>	
                </ul>
            </section>
        </nav>
    </div>
</header>
<section id="content">
    <div class="row">
	
	<div class="large-6 large-push-3 columns">
            <div class="section" id="paging">
<h1>Paging<a class="headerlink" href="#paging" title="Permalink to this headline">¶</a></h1>
<p>When a query returns many rows, it would be inefficient to return them
as a single response message. Instead, the driver breaks the results
into <em>pages</em> which get returned as they are needed.</p>
<div class="section" id="setting-the-fetch-size">
<h2>Setting the fetch size<a class="headerlink" href="#setting-the-fetch-size" title="Permalink to this headline">¶</a></h2>
<p>The <em>fetch size</em> specifies how many rows will be returned at once by
Cassandra (in other words, it’s the size of each page).</p>
<p>You can set a default fetch size globally for a <code class="docutils literal notranslate"><span class="pre">Cluster</span></code> instance:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="c1">// At initialization:</span>
<span class="n">Cluster</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">addContactPoint</span><span class="o">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withQueryOptions</span><span class="o">(</span><span class="k">new</span> <span class="n">QueryOptions</span><span class="o">().</span><span class="na">setFetchSize</span><span class="o">(</span><span class="mi">2000</span><span class="o">))</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>

<span class="c1">// Or at runtime:</span>
<span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">().</span><span class="na">getQueryOptions</span><span class="o">().</span><span class="na">setFetchSize</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
</pre></div>
</div>
<p>The fetch size can also be set on a statement:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Statement</span> <span class="n">statement</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleStatement</span><span class="o">(</span><span class="s">&quot;your query&quot;</span><span class="o">);</span>
<span class="n">statement</span><span class="o">.</span><span class="na">setFetchSize</span><span class="o">(</span><span class="mi">2000</span><span class="o">);</span>
</pre></div>
</div>
<p>If the fetch size is set on a statement, it will take precedence;
otherwise, the cluster-wide value (which defaults to 5000) will be used.</p>
<p>Note that setting a fetch size doesn’t mean that Cassandra will always
return the exact number of rows, it is possible that it returns slightly
more or less results.</p>
</div>
<div class="section" id="result-set-iteration">
<h2>Result set iteration<a class="headerlink" href="#result-set-iteration" title="Permalink to this headline">¶</a></h2>
<p>The fetch size limits the number of results that are returned in one
page; if you iterate past that, the driver will run background queries
to fetch subsequent pages. Here’s an example with a fetch size of 20:</p>
<div class="highlight-ditaa notranslate"><div class="highlight"><pre><span></span>    client         Session                          Cassandra
    --+--------------+---------------------------------+-----
      <span class="p">|</span>execute<span class="o">(</span>query<span class="o">)</span><span class="p">|</span>                                 <span class="p">|</span>
      <span class="p">|</span>-------------&gt;<span class="p">|</span>                                 <span class="p">|</span>
      <span class="p">|</span>              <span class="p">|</span> query rows <span class="m">1</span> to <span class="m">20</span>              <span class="p">|</span>
      <span class="p">|</span>              <span class="p">|</span>--------------------------------&gt;<span class="p">|</span>
      <span class="p">|</span>              <span class="p">|</span>                                 <span class="p">|</span>
      <span class="p">|</span>              <span class="p">|</span>create                           <span class="p">|</span>
      <span class="p">|</span>              <span class="p">|</span>------&gt;ResultSet                 <span class="p">|</span>
      <span class="p">|</span>                          <span class="p">|</span>                     <span class="p">|</span>
+-----+--------+-----------------+-+                   <span class="p">|</span>
<span class="p">|</span>For i in <span class="m">1</span>..20<span class="p">|</span>                 <span class="p">|</span> <span class="p">|</span>                   <span class="p">|</span>
+--------------+                 <span class="p">|</span> <span class="p">|</span>                   <span class="p">|</span>
<span class="p">|</span>     <span class="p">|</span>        get next row      <span class="p">|</span> <span class="p">|</span>                   <span class="p">|</span>
<span class="p">|</span>     <span class="p">|</span>-------------------------&gt;<span class="p">|</span> <span class="p">|</span>                   <span class="p">|</span>
<span class="p">|</span>     <span class="p">|</span>          row i           <span class="p">|</span> <span class="p">|</span>                   <span class="p">|</span>
<span class="p">|</span>     <span class="p">|</span>&lt;-------------------------<span class="p">|</span> <span class="p">|</span>                   <span class="p">|</span>
<span class="p">|</span>     <span class="p">|</span>                          <span class="p">|</span> <span class="p">|</span>                   <span class="p">|</span>
+-----+--------------------------+-+                   <span class="p">|</span>
      <span class="p">|</span>                          <span class="p">|</span>                     <span class="p">|</span>
      <span class="p">|</span>                          <span class="p">|</span>                     <span class="p">|</span>
      <span class="p">|</span>        get next row      <span class="p">|</span>                     <span class="p">|</span>
      <span class="p">|</span>-------------------------&gt;<span class="p">|</span>                     <span class="p">|</span>
      <span class="p">|</span>                          <span class="p">|</span> query rows <span class="m">21</span> to <span class="m">40</span> <span class="p">|</span>
      <span class="p">|</span>                          <span class="p">|</span>--------------------&gt;<span class="p">|</span>
      <span class="p">|</span>          row <span class="m">21</span>          <span class="p">|</span>                     <span class="p">|</span>
      <span class="p">|</span>&lt;------------------------ <span class="p">|</span>                     <span class="p">|</span>
</pre></div>
</div>
<p>By default, the background fetch happens at the last moment, when there
are no more “local” rows available. If you need finer control, the
<a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/ResultSet.html">ResultSet</a> interface provides the following methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">getAvailableWithoutFetching()</span></code> and <code class="docutils literal notranslate"><span class="pre">isFullyFetched()</span></code> to check the
current state;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">fetchMoreResults()</span></code> to force a page fetch.</p></li>
</ul>
<p>Here’s how you could use these methods to pre-fetch the next page in
advance, in order to avoid the performance hit at the end of each page:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&quot;your query&quot;</span><span class="o">);</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Row</span> <span class="n">row</span> <span class="o">:</span> <span class="n">rs</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">getAvailableWithoutFetching</span><span class="o">()</span> <span class="o">==</span> <span class="mi">100</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">rs</span><span class="o">.</span><span class="na">isFullyFetched</span><span class="o">())</span>
        <span class="n">rs</span><span class="o">.</span><span class="na">fetchMoreResults</span><span class="o">();</span> <span class="c1">// this is asynchronous</span>
    <span class="c1">// Process the row ...</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">row</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>If you use paging with the async API, you’ll also want to use those
methods to avoid triggering synchronous fetches unintentionally; see
<a class="reference external" href="../async/#async-paging">async paging</a>.</p>
</div>
<div class="section" id="saving-and-reusing-the-paging-state">
<h2>Saving and reusing the paging state<a class="headerlink" href="#saving-and-reusing-the-paging-state" title="Permalink to this headline">¶</a></h2>
<p>Sometimes it is convenient to save the paging state in order to restore
it later. For example, consider a stateless web service that displays a
list of results with a link to the next page. When the user clicks that
link, we want to run the exact same query, except that the iteration
should start where we stopped on the previous page.</p>
<p>To do so, the driver exposes a <a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/PagingState.html">PagingState</a> object that represents
where we were in the result set when the last page was fetched:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ResultSet</span> <span class="n">resultSet</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="s">&quot;your query&quot;</span><span class="o">);</span>
<span class="c1">// iterate the result set...</span>
<span class="n">PagingState</span> <span class="n">pagingState</span> <span class="o">=</span> <span class="n">resultSet</span><span class="o">.</span><span class="na">getExecutionInfo</span><span class="o">().</span><span class="na">getPagingState</span><span class="o">();</span>
</pre></div>
</div>
<p>This object can be serialized to a <code class="docutils literal notranslate"><span class="pre">String</span></code> or a byte array:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">String</span> <span class="n">string</span> <span class="o">=</span> <span class="n">pagingState</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">pagingState</span><span class="o">.</span><span class="na">toBytes</span><span class="o">();</span>
</pre></div>
</div>
<p>This serialized form can be saved in some form of persistent storage to
be reused later. In our web service example, we would probably save the
string version as a query parameter in the URL to the next page
(<code class="docutils literal notranslate"><span class="pre">http://myservice.com/results?page=&lt;...&gt;</span></code>). When that value is
retrieved later, we can deserialize it and reinject it in a statement:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">PagingState</span> <span class="n">pagingState</span> <span class="o">=</span> <span class="n">PagingState</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="n">string</span><span class="o">);</span>
<span class="n">Statement</span> <span class="n">st</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleStatement</span><span class="o">(</span><span class="s">&quot;your query&quot;</span><span class="o">);</span>
<span class="n">st</span><span class="o">.</span><span class="na">setPagingState</span><span class="o">(</span><span class="n">pagingState</span><span class="o">);</span>
<span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">st</span><span class="o">);</span>
</pre></div>
</div>
<p>Note that the paging state can only be reused with the exact same
statement (same query string, same parameters). Also, it is an opaque
value that is only meant to be collected, stored an re-used. If you try
to modify its contents or reuse it with a different statement, the
driver will raise an error.</p>
<p>Putting it all together, here’s a more comprehensive example
implementation for our web service:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">final</span> <span class="kt">int</span> <span class="n">RESULTS_PER_PAGE</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>

<span class="n">Statement</span> <span class="n">st</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SimpleStatement</span><span class="o">(</span><span class="s">&quot;your query&quot;</span><span class="o">);</span>
<span class="n">st</span><span class="o">.</span><span class="na">setFetchSize</span><span class="o">(</span><span class="n">RESULTS_PER_PAGE</span><span class="o">);</span>

<span class="n">String</span> <span class="n">requestedPage</span> <span class="o">=</span> <span class="n">extractPagingStateStringFromURL</span><span class="o">();</span>
<span class="c1">// This will be absent for the first page</span>
<span class="k">if</span> <span class="o">(</span><span class="n">requestedPage</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">st</span><span class="o">.</span><span class="na">setPagingState</span><span class="o">(</span>
        <span class="n">PagingState</span><span class="o">.</span><span class="na">fromString</span><span class="o">(</span><span class="n">requestedPage</span><span class="o">));</span>
<span class="o">}</span>

<span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">st</span><span class="o">);</span>
<span class="n">PagingState</span> <span class="n">nextPage</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getExecutionInfo</span><span class="o">().</span><span class="na">getPagingState</span><span class="o">();</span>

<span class="c1">// Note that we don&#39;t rely on RESULTS_PER_PAGE, since Cassandra might</span>
<span class="c1">// have not respected it, or we might be at the end of the result set</span>
<span class="kt">int</span> <span class="n">remaining</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getAvailableWithoutFetching</span><span class="o">();</span>
<span class="k">for</span> <span class="o">(</span><span class="n">Row</span> <span class="n">row</span> <span class="o">:</span> <span class="n">rs</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">renderInResponse</span><span class="o">(</span><span class="n">row</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(--</span><span class="n">remaining</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">break</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="c1">// This will be null if there are no more pages</span>
<span class="k">if</span> <span class="o">(</span><span class="n">nextPage</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">renderNextPageLink</span><span class="o">(</span><span class="n">nextPage</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Due to internal implementation details, <code class="docutils literal notranslate"><span class="pre">PagingState</span></code> instances are not
portable across <a class="reference external" href="../native_protocol/">native protocol</a> versions. This
could become a problem in the following scenario:</p>
<ul class="simple">
<li><p>you’re using the driver 2.0.x and Cassandra 2.0.x, and therefore
native protocol v2;</p></li>
<li><p>a user bookmarks a link to your web service that contains a serialized
paging state;</p></li>
<li><p>you upgrade your server stack to use the driver 2.1.x and Cassandra
2.1.x, so you’re now using protocol v3;</p></li>
<li><p>the user tries to reload their bookmark, but the paging state was
serialized with protocol v2, so trying to reuse it will fail.</p></li>
</ul>
<p>If this is not acceptable for you, you might want to consider the unsafe
API described in the next section.</p>
<p>Note: because of <a class="reference external" href="https://issues.apache.org/jira/browse/CASSANDRA-10880">CASSANDRA-10880</a>, paging states are also incompatible
between Cassandra 2.2 and 3.0, even if they’re both using native protocol v4.
This will manifest as the following error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">com</span><span class="o">.</span><span class="n">datastax</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ProtocolError</span><span class="p">:</span> <span class="n">An</span> <span class="n">unexpected</span> <span class="n">protocol</span> <span class="n">error</span> <span class="n">occurred</span> <span class="n">on</span> <span class="n">host</span> <span class="n">xxx</span><span class="o">.</span>
<span class="n">This</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">bug</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">library</span><span class="p">,</span> <span class="n">please</span> <span class="n">report</span><span class="p">:</span> <span class="n">Invalid</span> <span class="n">value</span> <span class="k">for</span> <span class="n">the</span> <span class="n">paging</span> <span class="n">state</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://github.com/apache/cassandra/blob/cassandra-3.0/NEWS.txt#L334-L336">Cassandra documentation</a>
recommends staying on protocol v3 during an upgrade between these two versions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Clients</span> <span class="n">must</span> <span class="n">use</span> <span class="n">the</span> <span class="n">native</span> <span class="n">protocol</span> <span class="n">version</span> <span class="mi">3</span> <span class="n">when</span> <span class="n">upgrading</span> <span class="kn">from</span> <span class="mf">2.2</span><span class="o">.</span><span class="n">X</span> <span class="k">as</span>
<span class="n">the</span> <span class="n">native</span> <span class="n">protocol</span> <span class="n">version</span> <span class="mi">4</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">compatible</span> <span class="n">between</span> <span class="mf">2.2</span><span class="o">.</span><span class="n">X</span> <span class="ow">and</span> <span class="mf">3.</span><span class="n">Y</span><span class="o">.</span> <span class="n">See</span>
<span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">mail</span><span class="o">-</span><span class="n">archive</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">user</span><span class="nd">@cassandra</span><span class="o">.</span><span class="n">apache</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">msg45381</span><span class="o">.</span><span class="n">html</span> <span class="k">for</span> <span class="n">details</span><span class="o">.</span>
</pre></div>
</div>
<div class="section" id="unsafe-api">
<h3>Unsafe API<a class="headerlink" href="#unsafe-api" title="Permalink to this headline">¶</a></h3>
<p>As an alternative to the standard API, there are two methods that
manipulate a raw <code class="docutils literal notranslate"><span class="pre">byte[]</span></code> instead of a <code class="docutils literal notranslate"><span class="pre">PagingState</span></code> object:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/ExecutionInfo.html#getPagingStateUnsafe--">ExecutionInfo#getPagingStateUnsafe()</a></p></li>
<li><p><a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/Statement.html#setPagingStateUnsafe-byte:A-">Statement#setPagingStateUnsafe(byte[])</a></p></li>
</ul>
<p>These low-level methods perform no validation on their arguments;
therefore nothing protects you from reusing a paging state that was
generated from a different statement, or altered in any way. This could
result in sending a corrupt paging state to Cassandra, with
unpredictable consequences (ranging from wrong results to a query
failure).</p>
<p>There are two situations where you might want to use the unsafe API:</p>
<ul class="simple">
<li><p>you never expose the paging state to end users and you are confident
that it won’t get altered;</p></li>
<li><p>you want portability across protocol versions and/or you prefer
implementing your own validation logic (for example, signing the raw
state with a private key).</p></li>
</ul>
</div>
</div>
<div class="section" id="offset-queries">
<h2>Offset queries<a class="headerlink" href="#offset-queries" title="Permalink to this headline">¶</a></h2>
<p>Saving the paging state works well when you only let the user move from
one page to the next. But it doesn’t allow random jumps (like “go
directly to page 10”), because you can’t fetch a page unless you have
the paging state of the previous one. Such a feature would require
<em>offset queries</em>, but they are not natively supported by Cassandra (see
<a class="reference external" href="https://issues.apache.org/jira/browse/CASSANDRA-6511">CASSANDRA-6511</a>).
The rationale is that offset queries are inherently inefficient (the
performance will always be linear in the number of rows skipped), so the
Cassandra team doesn’t want to encourage their use.</p>
<p>If you really want offset queries, you can emulate them client-side.
You’ll still get linear performance, but maybe that’s acceptable for
your use case. For example, if each page holds 10 rows and you show at
most 20 pages, this means you’ll fetch at most 190 extra rows, which
doesn’t sound like a big deal.</p>
<p>For example, if the page size is 10, the fetch size is 50, and the user
asks for page 12 (rows 110 to 119):</p>
<ul class="simple">
<li><p>execute the statement a first time (the result set contains rows 0 to
49, but you’re not going to use them, only the paging state);</p></li>
<li><p>execute the statement a second time with the paging state from the
first query;</p></li>
<li><p>execute the statement a third time with the paging state from the
second query. The result set now contains rows 100 to 149;</p></li>
<li><p>skip the first 10 rows of the iterator. Read the next 10 rows and
discard the remaining ones.</p></li>
</ul>
<p>You’ll want to experiment with the fetch size to find the best balance:
too small means many background queries; too big means bigger messages
and too many unneeded rows returned (we picked 50 above for the sake of
example, but it’s probably too small – the default is 5000).</p>
<p>Again, offset queries are inefficient by nature. Emulating them
client-side is a compromise when you think you can get away with the
performance hit. We recommend that you:</p>
<ul class="simple">
<li><p>test your code at scale with the expected query patterns, to make sure
that your assumptions are correct;</p></li>
<li><p>set a hard limit on the highest possible page number, to prevent
malicious users from triggering queries that would skip a huge amount
of rows.</p></li>
</ul>
</div>
</div>

        </div>

        <div id="sidebar" class="large-3 large-pull-6 columns"><div class="side-nav">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../README.html">Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../address_resolution/README.html">Address resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../async/README.html">Asynchronous programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auth/README.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cloud/README.html">Connecting to Apollo (Cloud)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compression/README.html">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../control_connection/README.html">Control connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../custom_codecs/README.html">Custom Codecs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../custom_payloads/README.html">Custom Payloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../idempotence/README.html">Query idempotence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../load_balancing/README.html">Load balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/README.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metadata/README.html">Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics/README.html">Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../native_protocol/README.html">Native protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../object_mapper/README.html">Object Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../osgi/README.html">OSGi</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Paging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pooling/README.html">Connection pooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../query_timestamps/README.html">Query timestamps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reconnection/README.html">Reconnection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../retries/README.html">Retries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shaded_jar/README.html">Using the shaded JAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../socket_options/README.html">Socket options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../speculative_execution/README.html">Speculative query execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ssl/README.html">SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../statements/README.html">Statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tuples/README.html">Using Tuples with the Java driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../udts/README.html">User-defined types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrade_guide/README.html">Upgrade guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/README.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/README.html">Changelog</a></li>
</ul>

</div>
        </div>

        <div class="large-3 columns">
            
        </div>

    </div>
</section>

<!-- newsleter modal -->

<div id="newsletter_signup" class="reveal-modal tiny radius dark_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <a class="close-reveal-modal" aria-label="Close">×</a>
    <h2 id="modalTitle">Sign up for the Scylla newsletter</h2>
    <div id="mc_embed_signup">
        <form action="//cloudius-systems.us10.list-manage.com/subscribe/post?u=df8bb543c68230d5f7b4dcf78&amp;id=9a4589f144" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
            <div id="mc_embed_signup_scroll">

                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-EMAIL">Email</label></div>
                        <div class="small-9 columns"><input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-FNAME">First Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="FNAME" class="" id="mce-FNAME"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-LNAME">Last Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="LNAME" class="" id="mce-LNAME"></div>
                    </div>
                </div>
                <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;"><input type="text" name="b_df8bb543c68230d5f7b4dcf78_9a4589f144" tabindex="-1" value=""></div>
                <div class="clear"><input type="submit" class="button" value="Sign up" name="subscribe" id="mc-embedded-subscribe"></div>
            </div>
        </form>
    </div>
</div>

<!-- end newsleter modal -->



<!-- footer.html -->
<footer id="footer">
    <div class="footer-top">
        <a class="logo" href="https://www.scylladb.com"><img src="../../_static/img/logo-scylla-horizontal-RGB.svg" alt=""></a>
        <div class="footer-links">
            <a class="link" href="https://docs.scylladb.com">Docs</a>
            <a class="link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
            <a class="link" href="https://www.scylladb.com/company/">About Us</a>
            <a class="link button" href="https://github.com/scylladb/java-driver/issues/new?title=Issue in page Paging&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20http://docs.scylladb.com/manual/paging/README%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix" target="_blank">
                Report an issue on this page</a>
        </div>
        <div class="footer-actions">
            <a class="link-icon" href="https://github.com/ScyllaDB" target="_blank">
                <span class="icon-github2"></span></a>
            <a class="link-icon" href="https://twitter.com/ScyllaDB" target="_blank">
                <span class="icon-twitter"></span></a>
            <a class="link-icon" href="https://www.linkedin.com/company/scylladb"  target="_blank">
                <span class="icon-linkedin2"></span></a>
            <a class="link-icon" href="https://www.facebook.com/scylladb/" target="_blank">
                <span class="icon-facebook"></span></a>
        </div>
    </div>

    <div class="footer-bottom">
        <div class="footer-info">
            <div class="footer-copyright">
                &#169; 2012, ScyllaDB. All rights reserved.
            </div>
            <div class="footer-last-updated">
                Last updated on 20 October 2020.
            </div>
        </div>
        <div class="footer-links">
        </div>
    </div>
</footer>
<!-- end footer.html -->

<!-- bodyscripts.html -->
<!-- at the end of the BODY --> 
<script src="../../_static/js/vendor/jquery.js"></script>
<script src="../../_static/expertrec.js"></script>
<script src="../../_static/js/foundation/foundation.js"></script>
<script src="../../_static/js/foundation/foundation.topbar.js"></script>
<script src="../../_static/app.js"></script>
<script>
    $(document).foundation();
</script>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <!-- end bodyscripts.html -->
</body>
</html>