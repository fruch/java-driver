


<!doctype html>
<html class="no-js" lang="en">
  
<head><!-- begin head.html -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
    Native protocol | Scylla Docs
    </title>
    <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server." />

    <link rel="icon" href="../../_static/img/favicon.ico" type="image/x-icon"/>
    <link rel="canonical" href="https://docs.scylladb.com/">

    <link rel="author" href="mailto:info@scylladb.com">
    <link rel="stylesheet" href="../../_static/" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx_tabs/tabs.css" />
    
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/foundation.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/css/doc/main.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>

    <script src="../../_static/js/vendor/modernizr.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T8P2JP');</script>
    <!-- End Google Tag Manager -->

    <!-- Marketo -->
    <script type="text/javascript"> (function() { var didInit = false; function initMunchkin() { if(didInit === false) { didInit = true; Munchkin.init('791-QBF-350'); } } var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//munchkin.marketo.net/munchkin.js'; s.onreadystatechange = function() { if (this.readyState == 'complete' || this.readyState == 'loaded') { initMunchkin(); } }; s.onload = initMunchkin; document.getElementsByTagName('head')[0].appendChild(s); })(); </script>
    <!-- End Marketo -->

<!-- end head.html -->
</head>

<body>
<header id="header" class="animated">
    <div class="topbar_continer contain-to-grid clearfix">
        <nav class="top-bar" id="top-bar" data-topbar role="navigation">
            <ul class="title-area">
                <li class="name">
                    <div class="logo">
                        <a href="https://docs.scylladb.com/"><img src="../../_static/img/logo-scylla-docs.svg" alt="" width="151"></a>
                    </div>
                </li>
                <li class="toggle-topbar"><a href="#"><span class="icon-manu"></span></a></li>
            </ul>
            <section class="top-bar-section clearfix">
                <ul class="right">
                    
                    <li>
                        <a href="https://scylladb.github.io/java-driver/">Scylla Java Driver</a>
                    </li>
                    
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">Scylla Cloud</a>
                    </li>
                    
                    <li>
                        <a href="https://university.scylladb.com/">Scylla University</a>
                    </li>
                    
                    <li>
                        <a href="https://www.scylladb.com/">ScyllaDB Home</a>
                    </li>
                    
                    <li class="search_continer show-for-medium-up">	
                        <ci-search></ci-search>	
                    </li>	
                </ul>
            </section>
        </nav>
    </div>
</header>
<section id="content">
    <div class="row">
	
	<div class="large-6 large-push-3 columns">
            <div class="section" id="native-protocol">
<h1>Native protocol<a class="headerlink" href="#native-protocol" title="Permalink to this headline">¶</a></h1>
<p>The native protocol defines the format of the binary messages exchanged
between the driver and Cassandra over TCP. As a driver user, you don’t
need to know the fine details (although the protocol spec is <a class="reference external" href="https://github.com/apache/cassandra/tree/trunk/doc">in the
Cassandra codebase</a> if you’re curious); the most visible
aspect is that some features are only available with specific protocol
versions.</p>
<div class="section" id="compatibility-matrix">
<h2>Compatibility matrix<a class="headerlink" href="#compatibility-matrix" title="Permalink to this headline">¶</a></h2>
<p>By default, the protocol version is negotiated between the driver and
Cassandra when the first connection is established. Both sides are
backward-compatible with older versions:</p>
<table border="1" style="text-align:center; width:100%;margin-bottom:1em;">
<tr><th>Driver Version</th><th>Cassandra: 1.2.x<br/>(DSE 3.2)</th><th>2.0.x<br/>(DSE 4.0 to 4.6)
</th><th>2.1.x<br/>(DSE 4.7)</th><th>2.2.x</th><th>3.0.x &amp; 3.x<br/>(DSE 5.0+)</th></tr>
<tr><th>1.0.x</th> <td>v1</td> <td>v1</td>  <td>v1</td> <td>v1</td>  <td>Unsupported <i>(1)</i></td> </tr>
<tr><th>2.0.x to 2.1.1</th> <td>v1</td> <td>v2</td>  <td>v2</td> <td>v2</td> <td>Unsupported <i>(1)</i></td> </tr>
<tr><th>2.1.2 to 2.1.x</th> <td>v1</td> <td>v2</td>  <td>v3</td> <td>v3</td> <td>Unsupported <i>(2)</i></td> </tr>
<tr><th>3.x</th> <td>v1</td> <td>v2</td>  <td>v3</td> <td>v4</td> <td>v4</td> </tr>
</table><p><em>(1) Cassandra 3.0 does not support protocol versions v1 and v2</em></p>
<p><em>(2) There is a matching protocol version (v3), but the driver 2.1.x can’t read the new system table format of Cassandra 3.0</em></p>
<p>For example, if you use version 2.1.5 of the driver to connect to
Cassandra 2.0.9, the maximum version you can use (and the one you’ll get
by default) is protocol v2 (third row, second column). If you use the
same version to connect to Cassandra 2.1.4, you can use protocol v3.</p>
</div>
<div class="section" id="controlling-the-protocol-version">
<h2>Controlling the protocol version<a class="headerlink" href="#controlling-the-protocol-version" title="Permalink to this headline">¶</a></h2>
<p>To find out which version you’re currently using, use
<a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/ProtocolOptions.html#getProtocolVersion--">ProtocolOptions#getProtocolVersion()</a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ProtocolVersion</span> <span class="n">myCurrentVersion</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="na">getConfiguration</span><span class="o">()</span>
    <span class="o">.</span><span class="na">getProtocolOptions</span><span class="o">()</span>
    <span class="o">.</span><span class="na">getProtocolVersion</span><span class="o">();</span>
</pre></div>
</div>
<p>The protocol version can not be changed at runtime. However, you can
force a given version at initialization:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Cluster</span> <span class="n">cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>
    <span class="o">.</span><span class="na">addContactPoint</span><span class="o">(</span><span class="s">&quot;127.0.0.1&quot;</span><span class="o">)</span>
    <span class="o">.</span><span class="na">withProtocolVersion</span><span class="o">(</span><span class="n">ProtocolVersion</span><span class="o">.</span><span class="na">V2</span><span class="o">)</span>
    <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</pre></div>
</div>
<p>If you specify a version that is not compatible with your current
driver/Cassandra combination, you’ll get an error:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="ne">Exception</span> <span class="ow">in</span> <span class="n">thread</span> <span class="s2">&quot;main&quot;</span> <span class="n">com</span><span class="o">.</span><span class="n">datastax</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">NoHostAvailableException</span><span class="p">:</span>
<span class="n">All</span> <span class="n">host</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">tried</span> <span class="k">for</span> <span class="n">query</span> <span class="n">failed</span>
<span class="p">(</span><span class="n">tried</span><span class="p">:</span> <span class="o">/</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">9042</span> <span class="p">(</span><span class="n">com</span><span class="o">.</span><span class="n">datastax</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">UnsupportedProtocolVersionException</span><span class="p">:</span>
  <span class="p">[</span><span class="o">/</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">9042</span><span class="p">]</span> <span class="n">Host</span> <span class="o">/</span><span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span><span class="p">:</span><span class="mi">9042</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">support</span> <span class="n">protocol</span> <span class="n">version</span> <span class="n">V3</span> <span class="n">but</span> <span class="n">V2</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="protocol-version-with-mixed-clusters">
<h3>Protocol version with mixed clusters<a class="headerlink" href="#protocol-version-with-mixed-clusters" title="Permalink to this headline">¶</a></h3>
<p>If you have a cluster with mixed versions (for example, while doing a
rolling upgrade of Cassandra), note that <strong>the protocol version will be
negotiated with the first host the driver connects to</strong>.</p>
<p>This could lead to the following situation (assuming you use driver
2.1.2+):</p>
<ul class="simple">
<li><p>the first contact point is a 2.1 host, so the driver negotiates
protocol v3;</p></li>
<li><p>while connecting to the rest of the cluster, the driver contacts a 2.0
host using protocol v3, which fails; an error is logged and this host
will be permanently ignored.</p></li>
</ul>
<p>To avoid this issue, you can use one the following workarounds:</p>
<ul class="simple">
<li><p>always force a protocol version at startup. You keep it at v2 while
the rolling upgrade is happening, and only switch to v3 when the whole
cluster has switched to Cassandra 2.1;</p></li>
<li><p>ensure that the list of initial contact points only contains hosts
with the oldest version (2.0 in this example).</p></li>
</ul>
</div>
</div>
<div class="section" id="new-features-by-protocol-version">
<h2>New features by protocol version<a class="headerlink" href="#new-features-by-protocol-version" title="Permalink to this headline">¶</a></h2>
<div class="section" id="v1-to-v2">
<h3>v1 to v2<a class="headerlink" href="#v1-to-v2" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>bound variables in simple statements
(<a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/Session.html#execute-java.lang.String-java.lang.Object...-">Session#execute(String, Object…)</a>)</p></li>
<li><p><a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/BatchStatement.html">batch statements</a></p></li>
<li><p><a class="reference external" href="../paging/">query paging</a></p></li>
</ul>
</div>
<div class="section" id="v2-to-v3">
<h3>v2 to v3<a class="headerlink" href="#v2-to-v3" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>the number of stream ids per connection goes from 128 to 32768 (see
<a class="reference external" href="../pooling/">Connection pooling</a>)</p></li>
<li><p><a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/BatchStatement.html#setSerialConsistencyLevel-com.datastax.driver.core.ConsistencyLevel-">serial consistency on batch statements</a></p></li>
<li><p><a class="reference external" href="../query_timestamps/">client-side timestamps</a></p></li>
</ul>
</div>
<div class="section" id="v3-to-v4">
<h3>v3 to v4<a class="headerlink" href="#v3-to-v4" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.datastax.com/en/drivers/java/3.10/com/datastax/driver/core/ExecutionInfo.html#getWarnings--">query warnings</a></p></li>
<li><p>allowed unset values in bound statements</p></li>
<li><p><a class="reference external" href="../custom_payloads/">Custom payloads</a></p></li>
</ul>
</div>
</div>
</div>

        </div>

        <div id="sidebar" class="large-3 large-pull-6 columns"><div class="side-nav">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API Documentation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../README.html">Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../address_resolution/README.html">Address resolution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../async/README.html">Asynchronous programming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auth/README.html">Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cloud/README.html">Connecting to Apollo (Cloud)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../compression/README.html">Compression</a></li>
<li class="toctree-l2"><a class="reference internal" href="../control_connection/README.html">Control connection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../custom_codecs/README.html">Custom Codecs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../custom_payloads/README.html">Custom Payloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="../idempotence/README.html">Query idempotence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../load_balancing/README.html">Load balancing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging/README.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metadata/README.html">Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../metrics/README.html">Metrics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Native protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="../object_mapper/README.html">Object Mapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="../osgi/README.html">OSGi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../paging/README.html">Paging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pooling/README.html">Connection pooling</a></li>
<li class="toctree-l2"><a class="reference internal" href="../query_timestamps/README.html">Query timestamps</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reconnection/README.html">Reconnection</a></li>
<li class="toctree-l2"><a class="reference internal" href="../retries/README.html">Retries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../shaded_jar/README.html">Using the shaded JAR</a></li>
<li class="toctree-l2"><a class="reference internal" href="../socket_options/README.html">Socket options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../speculative_execution/README.html">Speculative query execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ssl/README.html">SSL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../statements/README.html">Statements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tuples/README.html">Using Tuples with the Java driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../udts/README.html">User-defined types</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../upgrade_guide/README.html">Upgrade guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/README.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/README.html">Changelog</a></li>
</ul>

</div>
        </div>

        <div class="large-3 columns">
            
        </div>

    </div>
</section>

<!-- newsleter modal -->

<div id="newsletter_signup" class="reveal-modal tiny radius dark_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <a class="close-reveal-modal" aria-label="Close">×</a>
    <h2 id="modalTitle">Sign up for the Scylla newsletter</h2>
    <div id="mc_embed_signup">
        <form action="//cloudius-systems.us10.list-manage.com/subscribe/post?u=df8bb543c68230d5f7b4dcf78&amp;id=9a4589f144" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
            <div id="mc_embed_signup_scroll">

                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-EMAIL">Email</label></div>
                        <div class="small-9 columns"><input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-FNAME">First Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="FNAME" class="" id="mce-FNAME"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-LNAME">Last Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="LNAME" class="" id="mce-LNAME"></div>
                    </div>
                </div>
                <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;"><input type="text" name="b_df8bb543c68230d5f7b4dcf78_9a4589f144" tabindex="-1" value=""></div>
                <div class="clear"><input type="submit" class="button" value="Sign up" name="subscribe" id="mc-embedded-subscribe"></div>
            </div>
        </form>
    </div>
</div>

<!-- end newsleter modal -->



<!-- footer.html -->
<footer id="footer">
    <div class="footer-top">
        <a class="logo" href="https://www.scylladb.com"><img src="../../_static/img/logo-scylla-horizontal-RGB.svg" alt=""></a>
        <div class="footer-links">
            <a class="link" href="https://docs.scylladb.com">Docs</a>
            <a class="link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
            <a class="link" href="https://www.scylladb.com/company/">About Us</a>
            <a class="link button" href="https://github.com/scylladb/java-driver/issues/new?title=Issue in page Native protocol&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20http://docs.scylladb.com/manual/native_protocol/README%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix" target="_blank">
                Report an issue on this page</a>
        </div>
        <div class="footer-actions">
            <a class="link-icon" href="https://github.com/ScyllaDB" target="_blank">
                <span class="icon-github2"></span></a>
            <a class="link-icon" href="https://twitter.com/ScyllaDB" target="_blank">
                <span class="icon-twitter"></span></a>
            <a class="link-icon" href="https://www.linkedin.com/company/scylladb"  target="_blank">
                <span class="icon-linkedin2"></span></a>
            <a class="link-icon" href="https://www.facebook.com/scylladb/" target="_blank">
                <span class="icon-facebook"></span></a>
        </div>
    </div>

    <div class="footer-bottom">
        <div class="footer-info">
            <div class="footer-copyright">
                &#169; 2012, ScyllaDB. All rights reserved.
            </div>
            <div class="footer-last-updated">
                Last updated on 20 October 2020.
            </div>
        </div>
        <div class="footer-links">
        </div>
    </div>
</footer>
<!-- end footer.html -->

<!-- bodyscripts.html -->
<!-- at the end of the BODY --> 
<script src="../../_static/js/vendor/jquery.js"></script>
<script src="../../_static/expertrec.js"></script>
<script src="../../_static/js/foundation/foundation.js"></script>
<script src="../../_static/js/foundation/foundation.topbar.js"></script>
<script src="../../_static/app.js"></script>
<script>
    $(document).foundation();
</script>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <!-- end bodyscripts.html -->
</body>
</html>